import{d as P,e as O,u as M,r as a,s as A,j as e,L as F,f as p,N as I,O as R}from"./index-BqUALvqG.js";import{l as S}from"./logo-CFeMnnDy.js";const $="/assets/mujer-CquE4ycg.png",V="/assets/hombre-CW7aNu-F.png",L=[{to:"/dashboard",label:"Inicio"},{to:"/incomes",label:"Ingresos"},{to:"/expenses",label:"Gastos"},{to:"/balance",label:"Balance"},{to:"/reports",label:"Reportes"}];function W({children:b}){const i=P(),w=O(),{user:t,profile:l}=M(),[c,r]=a.useState(!1),[N,o]=a.useState(!1),x=a.useRef(null),m=l?.role==="admin",h=a.useMemo(()=>(l?.firstName??l?.fullName??"").split(/\s+/).filter(Boolean)[0]??null,[l]),f=a.useMemo(()=>{if(l?.lastName)return l.lastName.split(/\s+/).filter(Boolean)[0]??null;if(l?.fullName){const s=l.fullName.split(/\s+/).filter(Boolean);return s.length>1?s[1]:null}return null},[l]),j=a.useMemo(()=>{const s=[h,f].filter(Boolean);if(s.length>0)return s.join(" ");if(l?.fullName){const n=l.fullName.split(/\s+/).filter(Boolean);if(n.length>0)return n.slice(0,2).join(" ")}return t?.email?t.email.split("@")[0]:"Usuario"},[h,f,l,t]),U=a.useMemo(()=>{const s=[h?.[0],f?.[0]].filter(Boolean);if(s.length>0)return s.join("").toUpperCase();if(l?.fullName){const n=l.fullName.split(/\s+/).filter(Boolean);if(n.length>0)return n.slice(0,2).map(d=>d[0]).join("").toUpperCase()}return t?.email?t.email[0]?.toUpperCase()??"U":"U"},[h,f,l,t]),g=a.useMemo(()=>l?.gender==="female"?$:l?.gender==="male"?V:null,[l]),v=a.useCallback(async()=>{r(!1),o(!1),await A.auth.signOut(),i("/login",{replace:!0})},[i]);a.useEffect(()=>{if(!c)return;const s=d=>{x.current&&(x.current.contains(d.target)||r(!1))},n=d=>{d.key==="Escape"&&r(!1)};return document.addEventListener("mousedown",s),document.addEventListener("keydown",n),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("keydown",n)}},[c]);const E=a.useCallback(()=>{o(!1),r(s=>!s)},[]),B=a.useCallback(()=>{r(!1),o(s=>!s)},[]),u=a.useCallback(()=>{o(!1)},[]),C=a.useCallback(()=>{r(!1),o(!1),i("/profile")},[i]);a.useEffect(()=>{o(!1),r(!1)},[w.pathname]);const k=a.useCallback(({isActive:s})=>`shell-nav-link${s?" is-active":""}`,[]),y=a.useCallback(({isActive:s})=>`shell-mobile-nav-link${s?" is-active":""}`,[]);return e.jsxs("div",{className:"shell-root",children:[e.jsxs("header",{className:"shell-header",children:[e.jsxs(F,{to:"/dashboard",className:"shell-brand",children:[e.jsx("img",{src:S,alt:"Panel Contable",className:"shell-brand-logo"}),e.jsxs("div",{className:"shell-brand-copy",children:[e.jsx("strong",{children:"Panel Contable"}),e.jsx("p",{children:"Tu resumen financiero centralizado"})]})]}),e.jsxs("nav",{className:"shell-nav",children:[L.map(s=>e.jsx(p,{to:s.to,end:s.to==="/dashboard",className:k,onClick:u,children:s.label},s.to)),m?e.jsx(p,{to:"/admin/users",className:k,onClick:u,children:"Usuarios"}):null]}),e.jsxs("div",{className:"shell-header-actions",children:[e.jsx("button",{type:"button",className:"shell-menu-toggle",onClick:B,"aria-label":N?"Cerrar menú de navegación":"Abrir menú de navegación","aria-expanded":N,"aria-controls":"shell-mobile-menu",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:e.jsx("path",{d:"M4 7h16M4 12h16M4 17h16",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round"})})}),e.jsxs("div",{className:"shell-profile",ref:x,children:[e.jsxs("button",{type:"button",className:"shell-profile-trigger",onClick:E,"aria-haspopup":"menu","aria-expanded":c,children:[e.jsx("span",{className:"shell-avatar",children:g?e.jsx("img",{src:g,alt:l?.gender==="female"?"Perfil femenino":"Perfil masculino"}):e.jsx("span",{className:"shell-avatar-initials",children:U})}),e.jsxs("span",{className:"shell-profile-info",children:[e.jsx("span",{className:"shell-profile-name",children:j}),e.jsx("span",{className:"shell-profile-role",children:m?"Administrador":"Usuario"})]}),e.jsx("span",{className:`shell-profile-caret${c?" is-open":""}`,"aria-hidden":"true"})]}),c?e.jsxs("div",{className:"shell-profile-menu",role:"menu",children:[e.jsxs("div",{className:"shell-profile-menu-header",children:[e.jsx("span",{className:"shell-profile-menu-name",children:j}),e.jsx("span",{className:"shell-profile-menu-role",children:m?"Administrador":"Usuario"})]}),e.jsxs("div",{className:"shell-profile-menu-actions",children:[e.jsx("button",{type:"button",className:"shell-profile-menu-item",onClick:C,role:"menuitem",children:"Perfil"}),e.jsx("button",{type:"button",className:"shell-profile-menu-item",onClick:v,role:"menuitem",children:"Cerrar sesión"})]})]}):null]})]})]}),N?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"shell-mobile-backdrop",onClick:u,"aria-label":"Cerrar menú"}),e.jsxs("div",{className:"shell-mobile-menu",id:"shell-mobile-menu",children:[e.jsxs("div",{className:"shell-mobile-user",children:[e.jsx("span",{className:"shell-mobile-user-name",children:j}),e.jsx("span",{className:"shell-mobile-user-role",children:m?"Administrador":"Usuario"})]}),e.jsxs("nav",{className:"shell-mobile-nav",children:[L.map(s=>e.jsx(p,{to:s.to,end:s.to==="/dashboard",className:y,onClick:u,children:s.label},s.to)),m?e.jsx(p,{to:"/admin/users",className:y,onClick:u,children:"Usuarios"}):null]}),e.jsxs("div",{className:"shell-mobile-actions",children:[e.jsx("button",{type:"button",className:"shell-mobile-action",onClick:C,children:"Ver perfil"}),e.jsx("button",{type:"button",className:"shell-mobile-action shell-mobile-action--danger",onClick:v,children:"Cerrar sesión"})]})]})]}):null,e.jsx("main",{className:"shell-main",children:e.jsx("div",{className:"shell-main-inner",children:b})})]})}function D(){const{user:b,loading:i}=M();return i?e.jsx("div",{style:{display:"grid",placeItems:"center",minHeight:"100vh",backgroundColor:"#020b1d",color:"#e2e8f0"},children:e.jsx("p",{children:"Verificando sesión..."})}):b?e.jsx(W,{children:e.jsx(R,{})}):e.jsx(I,{to:"/login",replace:!0})}export{D as default};
