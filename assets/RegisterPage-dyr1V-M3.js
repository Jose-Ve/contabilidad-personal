import{u as V,d as R,r as l,j as e,N as D,L as S}from"./index-DB_UKz0h.js";import{u as B}from"./index.esm-B3JwpmJa.js";import{l as F}from"./logo-TWH5c1sz.js";const O="https://contabilidad-personal.onrender.com",C=/^[A-Za-zÃÃ‰ÃÃ“ÃšÃœÃ‘Ã¡Ã©Ã­Ã³ÃºÃ¼Ã±\s]+$/;function Z(){const{user:L}=V(),P=R(),[m,n]=l.useState(null),[N,b]=l.useState(null),[_,w]=l.useState(!1),[f,E]=l.useState(!1),[p,T]=l.useState(!1),{register:o,handleSubmit:q,watch:M,setValue:h,formState:{errors:a}}=B({defaultValues:{first_name:"",last_name:"",gender:"",email:"",password:"",confirmPassword:""}});if(L)return e.jsx(D,{to:"/dashboard",replace:!0});l.useEffect(()=>{if(!m)return;const s=window.setTimeout(()=>n(null),5e3);return()=>window.clearTimeout(s)},[m]);const d=s=>s.replace(/[^A-Za-zÃÃ‰ÃÃ“ÃšÃœÃ‘Ã¡Ã©Ã­Ã³ÃºÃ¼Ã±\s]+/g,""),g=s=>d(s).split(/\s+/).filter(Boolean).map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" "),v=s=>t=>{const i=t.target.value,c=d(i),r=g(c.trim());r!==i&&(t.target.value=r),h(s,r,{shouldValidate:!0,shouldDirty:r!==i})},z=async s=>{if(s.password!==s.confirmPassword){n("Las contraseÃ±as no coinciden.");return}const t=d(s.first_name),i=d(s.last_name),c=t.trim(),r=i.trim(),y=s.gender;if(!c||!r||!y){n("Completa tu nombre, apellido y gÃ©nero para continuar.");return}if(c.length<3||r.length<3){n("Nombre y apellido deben tener al menos 3 caracteres vÃ¡lidos.");return}const x=g(c),j=g(r);h("first_name",x,{shouldValidate:!1,shouldDirty:x!==s.first_name}),h("last_name",j,{shouldValidate:!1,shouldDirty:j!==s.last_name});try{w(!0),n(null),b(null);const u=await fetch(`${O}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s.email.trim(),password:s.password,first_name:x,last_name:j,gender:y})}),k=await u.json().catch(()=>null);if(!u.ok)throw new Error(k?.message??"No se pudo crear la cuenta");const A=k?.message??"Te has registrado correctamente. Te llegarÃ¡ un mensaje de confirmaciÃ³n a tu correo para poder acceder. El mensaje puede tardar un par de minutos en llegar.";b(A),setTimeout(()=>P("/login"),3e3)}catch(u){n(u.message)}finally{w(!1)}};return e.jsxs("main",{className:"register-page",children:[e.jsxs("section",{className:"register-visual","aria-hidden":"true",children:[e.jsx("div",{className:"register-visual__top",children:e.jsxs(S,{to:"/",className:"register-logo",children:[e.jsx("div",{className:"register-logo__mark",children:e.jsx("img",{src:F,alt:"Panel Contable"})}),e.jsx("span",{children:"Panel Contable"})]})}),e.jsx("div",{className:"register-visual__center",children:e.jsxs("div",{className:"register-glass",children:[e.jsx("div",{className:"register-glass__halo"}),e.jsxs("div",{className:"register-glass__content",children:[e.jsx("h2",{children:"Panel Financiero Inteligente"}),e.jsx("p",{children:"Orquesta ingresos, gastos y flujo neto en una sola vista."})]})]})}),e.jsx("div",{className:"register-visual__footer",children:e.jsx("p",{children:"Decisiones claras. Resultados en tiempo real."})})]}),e.jsx("section",{className:"register-form",role:"main",children:e.jsxs("div",{className:"register-form__inner",children:[e.jsxs("header",{className:"register-form__header",children:[e.jsx("h1",{children:"Crea tu cuenta"}),e.jsx("p",{children:"Configura tu espacio y sincroniza a tu equipo contable."})]}),e.jsxs("form",{onSubmit:q(z),className:"register-form__form",noValidate:!0,children:[e.jsxs("label",{className:"form-field",children:[e.jsx("span",{children:"Nombre"}),e.jsx("input",{type:"text",placeholder:"Tu nombre",...o("first_name",{required:"El nombre es obligatorio",minLength:{value:3,message:"MÃ­nimo 3 caracteres"},maxLength:{value:60,message:"MÃ¡ximo 60 caracteres"},pattern:{value:C,message:"Solo usa letras y espacios"},validate:s=>s.trim().length>=3||"Debe tener al menos 3 caracteres vÃ¡lidos"}),className:"form-input",onBlur:v("first_name")}),a.first_name?e.jsx("small",{className:"form-feedback form-feedback--error",children:a.first_name.message}):null]}),e.jsxs("label",{className:"form-field",children:[e.jsx("span",{children:"Apellido"}),e.jsx("input",{type:"text",placeholder:"Tu apellido",...o("last_name",{required:"El apellido es obligatorio",minLength:{value:3,message:"MÃ­nimo 3 caracteres"},maxLength:{value:60,message:"MÃ¡ximo 60 caracteres"},pattern:{value:C,message:"Solo usa letras y espacios"},validate:s=>s.trim().length>=3||"Debe tener al menos 3 caracteres vÃ¡lidos"}),className:"form-input",onBlur:v("last_name")}),a.last_name?e.jsx("small",{className:"form-feedback form-feedback--error",children:a.last_name.message}):null]}),e.jsxs("label",{className:"form-field",children:[e.jsx("span",{children:"GÃ©nero"}),e.jsxs("select",{...o("gender",{required:"Selecciona un gÃ©nero"}),className:"form-input form-input--select",defaultValue:"",children:[e.jsx("option",{value:"",disabled:!0,children:"Selecciona una opciÃ³n"}),e.jsx("option",{value:"female",children:"Femenino"}),e.jsx("option",{value:"male",children:"Masculino"})]}),a.gender?e.jsx("small",{className:"form-feedback form-feedback--error",children:a.gender.message}):null]}),e.jsxs("label",{className:"form-field",children:[e.jsx("span",{children:"Correo electrÃ³nico"}),e.jsx("input",{type:"email",placeholder:"tu@correo.com",required:!0,...o("email",{required:"El correo es obligatorio",pattern:{value:/^[^\s@]+@[^\s@]+\.(com|es|org|edu|gov|ni)$/i,message:"Usa un dominio vÃ¡lido (.com, .es, .org, .edu, .gov, .ni)"}}),className:"form-input"}),a.email?e.jsx("small",{className:"form-feedback form-feedback--error",children:a.email.message}):null]}),e.jsxs("label",{className:"form-field",children:[e.jsx("span",{children:"ContraseÃ±a"}),e.jsxs("div",{className:"form-input-wrapper",children:[e.jsx("input",{type:f?"text":"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0,...o("password",{required:"La contraseÃ±a es obligatoria",minLength:{value:8,message:"MÃ­nimo 8 caracteres"}}),className:"form-input"}),e.jsx("button",{type:"button",className:"form-input__toggle",onClick:()=>E(s=>!s),"aria-label":f?"Ocultar contraseÃ±a":"Mostrar contraseÃ±a",children:e.jsx("span",{"aria-hidden":"true",children:f?"ğŸ™ˆ":"ğŸ‘ï¸"})})]}),a.password?e.jsx("small",{className:"form-feedback form-feedback--error",children:a.password.message}):null]}),e.jsxs("label",{className:"form-field",children:[e.jsx("span",{children:"Confirmar contraseÃ±a"}),e.jsxs("div",{className:"form-input-wrapper",children:[e.jsx("input",{type:p?"text":"password",placeholder:"Repite tu contraseÃ±a",required:!0,...o("confirmPassword",{required:"Confirma tu contraseÃ±a",validate:s=>s===M("password")||"Las contraseÃ±as no coinciden"}),className:"form-input"}),e.jsx("button",{type:"button",className:"form-input__toggle",onClick:()=>T(s=>!s),"aria-label":p?"Ocultar confirmaciÃ³n de contraseÃ±a":"Mostrar confirmaciÃ³n de contraseÃ±a",children:e.jsx("span",{"aria-hidden":"true",children:p?"ğŸ™ˆ":"ğŸ‘ï¸"})})]}),a.confirmPassword?e.jsx("small",{className:"form-feedback form-feedback--error",children:a.confirmPassword.message}):null]}),m?e.jsx("p",{className:"form-feedback form-feedback--error",children:m}):null,N?e.jsx("p",{className:"form-feedback form-feedback--success",children:N}):null,e.jsx("button",{type:"submit",disabled:_,className:"form-submit",children:_?"Creando cuenta...":"Crear cuenta"})]}),e.jsxs("p",{className:"register-form__footer",children:["Â¿Ya tienes cuenta?"," ",e.jsx(S,{to:"/login",className:"register-form__link",children:"Iniciar sesiÃ³n"})]})]})})]})}export{Z as default};
