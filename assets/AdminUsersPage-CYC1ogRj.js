import{u as Z,r as a,a as v,j as e}from"./index-BnMz-dVJ.js";const ee={female:"Femenino",male:"Masculino"};function ae(){const{user:n}=Z(),[c,y]=a.useState([]),[T,C]=a.useState(!0),[N,$]=a.useState(null),[h,d]=a.useState(null),[x,j]=a.useState(null),[i,q]=a.useState(null),[u,w]=a.useState({first_name:"",last_name:"",gender:""}),[S,A]=a.useState(!1),[o,f]=a.useState(null),[k,B]=a.useState(""),[_,G]=a.useState("all"),[g,I]=a.useState("all"),[b,H]=a.useState("all"),D=a.useCallback(async()=>{if(!n){y([]),C(!1);return}C(!0);try{const s=await v("/admin/users");y(Array.isArray(s)?s:[]),$(null)}catch(s){console.error("Error cargando usuarios",s),$(s.message??"No se pudieron cargar los usuarios")}finally{C(!1)}},[n]);a.useEffect(()=>{D()},[D]),a.useEffect(()=>{if(!h)return;const s=setTimeout(()=>d(null),4e3);return()=>clearTimeout(s)},[h]);const m=a.useCallback(s=>{y(r=>r.map(l=>l.id===s.id?{...l,...s}:l))},[]),W=a.useCallback(async s=>{const r=s.role==="admin"?"user":"admin";f({type:"role",user:s,payload:{role:r}})},[m]),O=a.useCallback(async s=>{const r=!s.active;f({type:"state",user:s,payload:{active:r}})},[m]),M=a.useCallback(()=>{f(null)},[]),V=a.useCallback(async()=>{if(!o)return;const{user:s,type:r,payload:l}=o;if(r==="role"){j(`role:${s.id}`);try{const t=await v(`/admin/users/${s.id}/role`,{method:"PATCH",body:l});m(t),d({type:"success",message:"Rol actualizado correctamente."})}catch(t){console.error("Error cambiando rol",t),d({type:"error",message:t.message??"No se pudo cambiar el rol."})}finally{j(null)}}else if(r==="state"){j(`state:${s.id}`);try{const t=await v(`/admin/users/${s.id}/state`,{method:"PATCH",body:l});m(t),d({type:"success",message:l.active?"Cuenta reactivada correctamente.":"Cuenta desactivada correctamente."})}catch(t){console.error("Error actualizando estado",t),d({type:"error",message:t.message??"No se pudo actualizar el estado."})}finally{j(null)}}f(null)},[o,m]),J=a.useCallback(s=>{const r=s.first_name??P(s.full_name)??"",l=s.last_name??U(s.full_name)??"";w({first_name:r,last_name:l,gender:s.gender??""}),q(s)},[]),E=a.useCallback(s=>{const{name:r,value:l}=s.target;w(t=>({...t,[r]:l}))},[]),p=a.useCallback(()=>{q(null),A(!1)},[]),K=a.useCallback(async s=>{if(s.preventDefault(),!i)return;const r=u.first_name.trim(),l=u.last_name.trim();if(!r||!l||!u.gender){d({type:"error",message:"Completa nombre, apellido y gÃ©nero."});return}A(!0);try{const t=await v(`/admin/users/${i.id}/profile`,{method:"PATCH",body:{first_name:r,last_name:l,gender:u.gender}});m(t),d({type:"success",message:"Datos de usuario actualizados."}),p()}catch(t){console.error("Error actualizando datos del usuario",t),d({type:"error",message:t.message??"No se pudieron guardar los cambios."})}finally{A(!1)}},[u,i,p,m]),R=a.useMemo(()=>c.slice().sort((s,r)=>L(r.created_at)-L(s.created_at)),[c]),z=a.useMemo(()=>{const s=k.trim().toLowerCase();return R.filter(r=>{const l=s.length===0?!0:[r.email,r.first_name,r.last_name,r.full_name].filter(Boolean).some(Y=>Y.toLowerCase().includes(s)),t=_==="all"||r.role===_,Q=g==="all"||(r.active?"active":"inactive")===g,X=b==="all"||(b==="confirmed"?!!r.email_confirmed_at:!r.email_confirmed_at);return l&&t&&Q&&X})},[R,k,_,g,b]);return e.jsxs("section",{className:"users",children:[e.jsxs("header",{className:"users__header",children:[e.jsx("h2",{children:"GestiÃ³n de usuarios"}),e.jsx("p",{children:"Disponible solo para administradores. MantÃ©n el acceso seguro y roles actualizados desde un entorno unificado."})]}),e.jsxs("article",{className:"users-card",children:[e.jsxs("span",{className:"users-card__status",children:[e.jsx("span",{"aria-hidden":!0,children:"ðŸ›¡ï¸"}),"Seguridad en vivo"]}),e.jsxs("div",{className:"users-card__filters",role:"search",children:[e.jsxs("div",{className:"users-filter users-filter--search",children:[e.jsx("label",{htmlFor:"users-filter-search",children:"Buscar"}),e.jsx("input",{id:"users-filter-search",type:"search",placeholder:"Buscar por nombre o correo",value:k,onChange:s=>B(s.target.value)})]}),e.jsxs("div",{className:"users-filter",children:[e.jsx("label",{htmlFor:"users-filter-role",children:"Rol"}),e.jsxs("select",{id:"users-filter-role",value:_,onChange:s=>G(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos"}),e.jsx("option",{value:"admin",children:"Administradores"}),e.jsx("option",{value:"user",children:"Usuarios"})]})]}),e.jsxs("div",{className:"users-filter",children:[e.jsx("label",{htmlFor:"users-filter-state",children:"Cuenta"}),e.jsxs("select",{id:"users-filter-state",value:g,onChange:s=>I(s.target.value),children:[e.jsx("option",{value:"all",children:"Todas"}),e.jsx("option",{value:"active",children:"Activas"}),e.jsx("option",{value:"inactive",children:"Inactivas"})]})]}),e.jsxs("div",{className:"users-filter",children:[e.jsx("label",{htmlFor:"users-filter-confirmation",children:"Correo"}),e.jsxs("select",{id:"users-filter-confirmation",value:b,onChange:s=>H(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos"}),e.jsx("option",{value:"confirmed",children:"Confirmados"}),e.jsx("option",{value:"pending",children:"Pendientes"})]})]})]}),h?e.jsx("div",{className:`users-alert users-alert--${h.type}`,children:h.message}):null,T?e.jsx("p",{className:"users-empty",children:"Cargando usuarios..."}):null,N?e.jsx("p",{className:"users-error",children:N}):null,!T&&!N?z.length===0?e.jsx("p",{className:"users-empty",children:"No se encontraron usuarios con los filtros aplicados."}):e.jsx("div",{className:"users-table__wrapper",children:e.jsxs("table",{className:"users-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Correo"}),e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Apellido"}),e.jsx("th",{children:"GÃ©nero"}),e.jsx("th",{children:"Rol"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{className:"users-table__actions",children:"Acciones"})]})}),e.jsx("tbody",{children:z.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:s.email}),e.jsx("td",{children:s.first_name??P(s.full_name)??"â€”"}),e.jsx("td",{children:s.last_name??U(s.full_name)??"â€”"}),e.jsx("td",{className:"users-table__gender",children:ee[s.gender]??"Sin registrar"}),e.jsx("td",{className:"users-table__role",children:s.role}),e.jsx("td",{children:e.jsx("span",{className:`users-table__badge ${s.active?"":"users-table__badge--inactive"}`,children:s.active?"Activo":"Inactivo"})}),e.jsxs("td",{className:"users-table__actions",children:[e.jsx("button",{type:"button",className:"users-action users-action--primary",onClick:()=>W(s),disabled:x===`role:${s.id}`,children:"Cambiar rol"}),e.jsx("button",{type:"button",className:"users-action users-action--ghost",onClick:()=>J(s),disabled:x?.startsWith("role:")||x?.startsWith("state:"),children:"Ver datos"}),e.jsx("button",{type:"button",className:`users-action ${s.active?"users-action--danger":"users-action--success"}`,onClick:()=>O(s),disabled:x===`state:${s.id}`,children:s.active?"Desactivar":"Activar"})]})]},s.id))})]})}):null]}),i?e.jsx("div",{className:"users-modal",role:"dialog","aria-modal":"true",onClick:s=>{s.target===s.currentTarget&&p()},children:e.jsxs("div",{className:"users-modal__content",children:[e.jsxs("header",{className:"users-modal__header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Detalles del usuario"}),e.jsx("p",{children:i.email})]}),e.jsx("button",{type:"button",className:"users-modal__close",onClick:p,"aria-label":"Cerrar",children:"Ã—"})]}),e.jsxs("form",{className:"users-modal__form",onSubmit:K,children:[e.jsxs("p",{className:"users-modal__notice",children:["Puedes cambiar los datos de este usuario.",e.jsx("span",{className:`users-status ${i.email_confirmed_at?"users-status--confirmed":"users-status--pending"}`,children:i.email_confirmed_at?"Correo confirmado":"Correo pendiente"})]}),e.jsxs("label",{className:"users-modal__field",children:[e.jsx("span",{children:"Nombre"}),e.jsx("input",{name:"first_name",type:"text",value:u.first_name,onChange:E,placeholder:"Nombre",required:!0})]}),e.jsxs("label",{className:"users-modal__field",children:[e.jsx("span",{children:"Apellido"}),e.jsx("input",{name:"last_name",type:"text",value:u.last_name,onChange:E,placeholder:"Apellido",required:!0})]}),e.jsxs("label",{className:"users-modal__field",children:[e.jsx("span",{children:"GÃ©nero"}),e.jsxs("select",{name:"gender",value:u.gender,onChange:E,required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Selecciona un gÃ©nero"}),e.jsx("option",{value:"female",children:"Femenino"}),e.jsx("option",{value:"male",children:"Masculino"})]})]}),e.jsxs("div",{className:"users-modal__footer",children:[e.jsx("button",{type:"button",className:"users-action users-action--ghost",onClick:p,disabled:S,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"users-action users-action--primary",disabled:S,children:S?"Guardando...":"Guardar cambios"})]}),e.jsxs("dl",{className:"users-modal__meta",children:[e.jsxs("div",{children:[e.jsx("dt",{children:"Creado"}),e.jsx("dd",{children:F(i.created_at)})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Actualizado"}),e.jsx("dd",{children:F(i.updated_at)})]}),e.jsxs("div",{children:[e.jsx("dt",{children:"Estado del correo"}),e.jsx("dd",{children:i.email_confirmed_at?`Confirmado (${F(i.email_confirmed_at)})`:"Pendiente de confirmaciÃ³n"})]})]})]})]})}):null,o?e.jsx("div",{className:"users-modal",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"users-modal__content",children:[e.jsxs("header",{className:"users-modal__header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:o.type==="role"?"Confirmar cambio de rol":"Confirmar estado de cuenta"}),e.jsx("p",{children:o.user.email})]}),e.jsx("button",{type:"button",className:"users-modal__close",onClick:M,"aria-label":"Cerrar",children:"Ã—"})]}),e.jsx("div",{className:"users-modal__body",children:e.jsx("p",{children:o.type==="role"?o.payload.role==="admin"?"Â¿Seguro que quieres otorgar privilegios de administrador?":"Â¿Seguro que quieres quitar los privilegios de administrador?":o.payload.active?"Â¿Reactivar la cuenta para que pueda iniciar sesiÃ³n nuevamente?":"Â¿Desactivar la cuenta y bloquear el acceso del usuario?"})}),e.jsxs("div",{className:"users-modal__footer",children:[e.jsx("button",{type:"button",className:"users-action users-action--ghost",onClick:M,children:"Cancelar"}),e.jsx("button",{type:"button",className:`users-action ${o.type==="state"&&!o.payload.active?"users-action--danger":"users-action--primary"}`,onClick:V,children:"Confirmar"})]})]})}):null]})}function P(n){return n?n.split(/\s+/).filter(Boolean)[0]??null:null}function U(n){if(!n)return null;const c=n.split(/\s+/).filter(Boolean);return c.length>1?c.slice(1).join(" "):null}function F(n){if(!n)return"â€”";try{return new Date(n).toLocaleString("es-NI")}catch{return n}}function L(n){if(!n)return 0;const c=new Date(n).getTime();return Number.isFinite(c)?c:0}export{ae as default};
